<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Context Analysis | Patterns from {{ metrics.total_repos }}+ Repos</title>
    <link rel="icon" href="{{ url_for('static', filename='favicon.svg') }}" type="image/svg+xml">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='favicon.svg') }}">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f0f2f5;
            min-height: 100vh;
            color: #333;
        }

        /* === Hero === */
        .hero {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: white;
            padding: 60px 20px 50px;
            text-align: center;
        }

        .hero h1 {
            font-size: 2.8em;
            font-weight: 700;
            margin-bottom: 16px;
            letter-spacing: -0.5px;
        }

        .hero .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
            max-width: 720px;
            margin: 0 auto 20px;
            line-height: 1.6;
        }

        .hero .claude-definition {
            font-size: 0.95em;
            opacity: 0.7;
            max-width: 640px;
            margin: 0 auto;
            font-style: italic;
        }

        /* === Metrics Bar === */
        .metrics-bar {
            background: linear-gradient(135deg, #0f3460, #1a1a2e);
            border-top: 1px solid rgba(255,255,255,0.1);
            padding: 24px 20px;
        }

        .metrics-inner {
            display: flex;
            justify-content: center;
            gap: 48px;
            max-width: 800px;
            margin: 0 auto;
            flex-wrap: wrap;
        }

        .metric-item {
            text-align: center;
            color: white;
        }

        .metric-value {
            font-size: 2em;
            font-weight: 700;
            color: #4fc3f7;
            display: block;
        }

        .metric-label {
            font-size: 0.85em;
            opacity: 0.7;
            margin-top: 4px;
        }

        /* === Main Content === */
        .main-content {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* === Key Findings === */
        .key-findings {
            background: linear-gradient(135deg, #e8f5e9, #f1f8e9);
            border: 1px solid #c8e6c9;
            border-radius: 12px;
            padding: 24px 28px;
            margin-bottom: 36px;
        }

        .key-findings h2 {
            font-size: 1.2em;
            color: #2e7d32;
            margin-bottom: 14px;
        }

        .key-findings ul {
            list-style: none;
            padding: 0;
        }

        .key-findings li {
            padding: 6px 0;
            padding-left: 24px;
            position: relative;
            line-height: 1.5;
            color: #333;
        }

        .key-findings li::before {
            content: "\2192";
            position: absolute;
            left: 0;
            color: #2e7d32;
            font-weight: bold;
        }

        /* === Topic Cards === */
        .topics-section h2 {
            font-size: 1.5em;
            color: #1a1a2e;
            margin-bottom: 20px;
        }

        .topic-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            margin-bottom: 24px;
            overflow: hidden;
            transition: box-shadow 0.2s ease;
        }

        .topic-card:hover {
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .topic-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 20px 24px;
            border-left: 5px solid var(--topic-color);
        }

        .topic-icon {
            font-size: 1.5em;
        }

        .topic-title-group {
            flex: 1;
        }

        .topic-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #1a1a2e;
        }

        .topic-desc {
            font-size: 0.88em;
            color: #666;
            margin-top: 2px;
        }

        .topic-body {
            padding: 0 24px 20px;
        }

        .word-bar-row {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
        }

        .word-label {
            width: 110px;
            font-size: 0.88em;
            color: #444;
            font-weight: 500;
            text-align: right;
            padding-right: 12px;
            flex-shrink: 0;
        }

        .bar-container {
            flex: 1;
            background: #f0f2f5;
            border-radius: 4px;
            height: 22px;
            position: relative;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            border-radius: 4px;
            background: var(--topic-color);
            opacity: 0.8;
            transition: width 0.6s ease-out;
        }

        .bar-weight {
            width: 60px;
            font-size: 0.78em;
            color: #888;
            text-align: right;
            padding-left: 8px;
            flex-shrink: 0;
        }

        /* === Interpretation (What It Means) === */
        .interpretation-toggle {
            display: block;
            width: 100%;
            background: none;
            border: none;
            border-top: 1px solid #f0f2f5;
            padding: 12px 24px;
            text-align: left;
            cursor: pointer;
            font-size: 0.88em;
            color: #667eea;
            font-weight: 500;
            transition: background 0.2s;
        }

        .interpretation-toggle:hover {
            background: #f8f9ff;
        }

        .interpretation-content {
            display: none;
            padding: 0 24px 20px;
            font-size: 0.9em;
            line-height: 1.6;
            color: #555;
            border-top: 1px solid #f0f2f5;
        }

        .interpretation-content.open {
            display: block;
        }

        /* === Navigation Cards === */
        .nav-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        .nav-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            text-decoration: none;
            color: inherit;
        }

        .nav-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.12);
            text-decoration: none;
            color: inherit;
        }

        .nav-card h3 {
            color: #667eea;
            font-size: 1.2em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-card p {
            color: #666;
            line-height: 1.5;
            font-size: 0.92em;
            margin-bottom: 12px;
        }

        .nav-card .preview-text {
            font-size: 0.82em;
            color: #999;
            font-style: italic;
        }

        .nav-badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 500;
        }

        /* === Footer === */
        .footer {
            background: #1a1a2e;
            color: rgba(255,255,255,0.6);
            text-align: center;
            padding: 24px 20px;
            font-size: 0.85em;
            margin-top: 40px;
        }

        .footer a {
            color: #4fc3f7;
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        /* === No Data State === */
        .no-data-card {
            background: white;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            margin-bottom: 36px;
        }

        .no-data-card h2 {
            color: #1a1a2e;
            margin-bottom: 12px;
        }

        .no-data-card p {
            color: #666;
            line-height: 1.6;
        }

        /* === Responsive === */
        @media (max-width: 768px) {
            .hero h1 { font-size: 2em; }
            .hero .subtitle { font-size: 1.05em; }
            .metrics-inner { gap: 24px; }
            .metric-value { font-size: 1.6em; }
            .word-label { width: 80px; font-size: 0.82em; }
            .bar-weight { width: 50px; }
            .nav-cards { grid-template-columns: 1fr; }
        }

        @media (max-width: 480px) {
            .hero { padding: 40px 16px 36px; }
            .hero h1 { font-size: 1.6em; }
            .main-content { padding: 24px 16px; }
            .topic-header { padding: 16px; }
            .topic-body { padding: 0 16px 16px; }
            .word-label { width: 70px; font-size: 0.78em; }
        }
    </style>
</head>
<body>

    <!-- Hero Section -->
    <div class="hero">
        <h1>Claude Context Analysis</h1>
        <p class="subtitle">
            We analyze hundreds of public CLAUDE.md files from GitHub repositories to surface the patterns,
            common practices, and emerging conventions that shape how developers work with Claude.
        </p>
        <p class="claude-definition">
            CLAUDE.md files tell Claude Code how to work with a project, covering coding standards, build commands, and architecture decisions.
        </p>
    </div>

    <!-- Metrics Bar -->
    {% if has_data %}
    <div class="metrics-bar">
        <div class="metrics-inner">
            <div class="metric-item">
                <span class="metric-value">{{ metrics.total_repos }}</span>
                <span class="metric-label">Repositories Analyzed</span>
            </div>
            <div class="metric-item">
                <span class="metric-value">{{ metrics.files_processed }}</span>
                <span class="metric-label">CLAUDE.md Files Processed</span>
            </div>
            <div class="metric-item">
                <span class="metric-value">{{ metrics.topics_discovered }}</span>
                <span class="metric-label">Topics Discovered</span>
            </div>
            {% if metrics.last_analysis %}
            <div class="metric-item">
                <span class="metric-value" style="font-size: 1.2em;">{{ metrics.last_analysis }}</span>
                <span class="metric-label">Last Analysis</span>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <div class="main-content">

        {% if not has_data %}
        <!-- No data state -->
        <div class="no-data-card">
            <h2>Analysis Not Yet Available</h2>
            <p>The analysis runs daily at 3 AM GMT, collecting and processing CLAUDE.md files from GitHub.
               Check back after the next scheduled run to see topic analysis results.</p>
        </div>
        {% endif %}

        {% if key_findings %}
        <!-- Key Findings -->
        <div class="key-findings">
            <h2>Key Findings</h2>
            <ul>
                {% for finding in key_findings %}
                <li>{{ finding }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        {% if topics %}
        <!-- Topics Section -->
        <div class="topics-section">
            <h2>Discovered Topics</h2>

            {% for topic in topics %}
            <div class="topic-card" style="--topic-color: {{ topic.color }};">
                <div class="topic-header">
                    <span class="topic-icon">{{ topic.icon }}</span>
                    <div class="topic-title-group">
                        <div class="topic-title">{{ topic.label }}</div>
                        <div class="topic-desc">{{ topic.desc }}</div>
                    </div>
                </div>
                <div class="topic-body">
                    {% for w in topic.words %}
                    <div class="word-bar-row">
                        <span class="word-label">{{ w.word }}</span>
                        <div class="bar-container">
                            <div class="bar-fill" style="width: {{ w.pct }}%;"></div>
                        </div>
                        <span class="bar-weight">{{ w.weight }}</span>
                    </div>
                    {% endfor %}
                </div>
                <button class="interpretation-toggle" onclick="toggleInterpretation(this)">
                    What does this topic mean? &#9662;
                </button>
                <div class="interpretation-content">
                    {% if 'Code Guidelines' in topic.label or 'Code Style' in topic.label %}
                        <p>This topic captures how developers define coding standards and patterns for Claude to follow.
                        Words like "event," "state," and "function" suggest that many projects focus on event-driven architectures
                        and function-level guidelines. Strong presence of "error" and "return" indicate emphasis on error handling conventions.</p>
                    {% elif 'General' in topic.label or 'Cross' in topic.label %}
                        <p>A cross-cutting topic that spans multiple concerns. The mix of "validation," "api," and "error" terms
                        suggests these are common instructions that appear regardless of project type. This represents the shared
                        baseline of what most CLAUDE.md files address.</p>
                    {% elif 'Frontend' in topic.label %}
                        <p>Frontend-focused CLAUDE.md files are among the most detailed. The prevalence of "npm," "typescript,"
                        and "react" reflects the dominance of the React/TypeScript ecosystem in projects using Claude Code.
                        These files typically specify component patterns, state management, and build tooling.</p>
                    {% elif 'Backend' in topic.label %}
                        <p>Backend-oriented projects emphasize API design, database interactions, and service configuration.
                        The presence of "environment" and "integration" suggests these CLAUDE.md files often cover deployment
                        contexts and third-party service connections.</p>
                    {% elif 'Task' in topic.label or 'Implementation' in topic.label %}
                        <p>This topic captures how developers structure their requests to Claude, covering task workflows,
                        documentation patterns, and user context. It reflects the meta-layer of how teams organize their
                        Claude interactions beyond just code generation.</p>
                    {% else %}
                        <p>This topic represents a cluster of related terms discovered through topic modeling analysis.
                        The word weights indicate how strongly each term is associated with this theme across the analyzed repositories.</p>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Navigation Cards -->
        <div class="nav-cards">
            <a href="/how-it-works" class="nav-card">
                <h3>How It Works</h3>
                <p>Learn about the data collection pipeline, text preprocessing with NLTK, and Latent Dirichlet Allocation topic modeling.</p>
                <span class="preview-text">GitHub API, tokenization, LDA with scikit-learn</span>
                <br><span class="nav-badge">Technical</span>
            </a>

            <a href="/topic-evolution" class="nav-card">
                <h3>Topic Evolution</h3>
                <p>Track how topics change over time across multiple analysis runs. See topic stability and new topic emergence.</p>
                <span class="preview-text">{% if metrics.total_repos > 0 %}{{ metrics.total_repos }} files analyzed so far{% else %}Data builds with each daily run{% endif %}</span>
                <br><span class="nav-badge">Historical</span>
            </a>

            <a href="/trends" class="nav-card">
                <h3>Term Trends</h3>
                <p>See how the most common terms in CLAUDE.md files rise and fall in popularity across daily analysis runs.</p>
                <span class="preview-text">{% if metrics.total_repos > 0 %}{{ metrics.total_repos }} files per run, 15 terms tracked{% else %}Interactive line charts{% endif %}</span>
                <br><span class="nav-badge">Trends</span>
            </a>

            <a href="/visualization" class="nav-card">
                <h3>Full Visualization</h3>
                <p>View the complete generated topic visualization with detailed word distributions and topic strengths.</p>
                <span class="preview-text">Interactive topic breakdown</span>
                <br><span class="nav-badge">Visual</span>
            </a>
        </div>

    </div>

    <!-- Footer with privacy notice -->
    <div class="footer">
        <p><strong>Privacy:</strong> No user data is stored. All analysis is performed in memory on publicly available content. Temporary files are cleaned up after processing.</p>
        <p style="margin-top: 8px;">
            <a href="/how-it-works">How It Works</a> &middot;
            <a href="/trends">Term Trends</a> &middot;
            <a href="/topic-evolution">Topic Evolution</a> &middot;
            <a href="/visualization">Full Visualization</a>
        </p>
    </div>

    <script>
        function toggleInterpretation(btn) {
            const content = btn.nextElementSibling;
            const isOpen = content.classList.contains('open');
            content.classList.toggle('open');
            btn.innerHTML = isOpen
                ? 'What does this topic mean? &#9662;'
                : 'What does this topic mean? &#9652;';
        }
    </script>
</body>
</html>
